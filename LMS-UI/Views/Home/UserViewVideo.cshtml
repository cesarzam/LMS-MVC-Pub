@model Video
@using System.IO

@if (Model != null)
{
    <div class="container">
        <h2 class="mt-4">Video Details</h2>
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title">ID: @Model.Id</h5>
                <h5 class="card-title">Title: @Model.Title</h5>
                <h5 class="card-text">Description: @Model.Description</h5>
            </div>
        </div>

        <div class="embed-responsive embed-responsive-16by9 mt-4">
            <video id="videoPlayer" class="embed-responsive-item" controls>
                @{
                    var fileInfo = new FileInfo(Model.FilePath);
                    var videoFileName = fileInfo.Name;
                }

                <!-- Call the GetVideo action with the correct video file name -->
                <source src="@Url.Action("GetVideo", "Home", new { videoFileName })" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
    </div>

    <script>
        var videoPlayer = document.getElementById('videoPlayer');

        videoPlayer.addEventListener('ended', function () {
            // Video has ended, send information to the server for tracking
            sendVideoTrackingInfo(true);
        });

        videoPlayer.addEventListener('timeupdate', function () {
            // Video playback time has changed, send information to the server for tracking
            sendVideoTrackingInfo(false);
        });

        function sendVideoTrackingInfo(isVideoEnd) {
            // Send an AJAX request to your server to track video playback
            var currentTime = videoPlayer.currentTime;
            var duration = videoPlayer.duration;

            // Calculate percentage completion
            var completionPercentage = (currentTime / duration) * 100;

            // You can send this information to the server using an AJAX request
            // Example using jQuery
            $.ajax({
                type: 'POST',
                url: '/Home/TrackVideoPlayback',
                data: {
                    videoId: @Model.Id,
                    completionPercentage: completionPercentage,
                    isVideoEnd: isVideoEnd
                },
                success: function (response) {
                    console.log('Video tracking data sent successfully');
                },
                error: function (error) {
                    console.error('Error sending video tracking data');
                }
            });
        }
    </script>

}
else
{
    <p>Video not found.</p>
}
